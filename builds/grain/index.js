window.HYPUR={LOADING:!1};function v(){window.HYPUR.LOADING=!0}function l(){window.HYPUR.LOADING=!1}var i={start:v,end:l};var o=new WeakMap;class p{name;base;listeners;defaultState;constructor(t,n,e){this.name=t;let a=e||document.querySelector(`[grain="${t}"]`);if(!a)throw new Error(`HTMLElement ${t} does not exist`);this.base=a,this.listeners=[],this.defaultState=n,o.set(a,n||{}),document.addEventListener("DOMContentLoaded",async()=>{await Promise.resolve(this.handle())})}get state(){return o.get(this.base)}setState(t){this.state={...this.state,...t(this.state)}}resetState(){this.state=this.defaultState||{}}set state(t){o.set(this.base,t)}innerText(t){this.base.innerText=t}innerHTML(t){this.base.innerHTML=t}outerHTML(t){this.base.outerHTML=t}onEvent(t,n){return this.listeners.push({eventType:t,action:n}),this.base.addEventListener(t,(e)=>{let a=o.get(this.base);n(e,a)}),this}onClick(t){return this.onEvent("click",t)}onChange(t){return this.onEvent("change",t)}onInput(t){return this.onEvent("input",t)}onMouseOver(t){return this.onEvent("mouseover",t)}onMouseOut(t){return this.onEvent("mouseout",t)}onKeyDown(t){return this.onEvent("keydown",t)}onKeyUp(t){return this.onEvent("keyup",t)}async fetcher(t,n){i.start();let e=new URL(window.origin,t),a=await fetch(e,{method:n,body:o.get(this.base)});return i.end(),a}async delete(t,n){let e=await this.fetcher(t,"DELETE");if(n)await Promise.resolve(n(e))}async put(t,n){let e=await this.fetcher(t,"PUT");if(n)await Promise.resolve(n(e))}async post(t,n){let e=await this.fetcher(t,"POST");if(n)await Promise.resolve(n(e))}async get(t,n){let e=await this.fetcher(t,"GET");if(n)await Promise.resolve(n(e))}async hypermedia(t,n,e){let s=await(await this.fetcher(t,n)).text();if(e)await Promise.resolve(e(s))}handle(){}}function u(t,n,e){let a=n.base.cloneNode(!0);if(e)Object.keys(e).forEach((s)=>{let r=a.querySelector(`[hypur="${s}"]`);if(r===null)throw new Error(`Grain of name ${s} could not be found`);r.innerText=e[s]});n.listeners.forEach((s)=>{a.addEventListener(s.eventType,(r)=>s.action(r,e||{}))}),o.set(a,e||{}),t.base.prepend(a)}function m(t,n,e){let a=n.base.cloneNode(!0);a.innerHTML=e,n.listeners.forEach((s)=>{a.addEventListener(s.eventType,(r)=>s.action(r,e||{}))}),o.set(a,e||{}),t.base.prepend(a)}var x={grain:u,hypermedia:m};function S(t,n,e){let a=n.base.cloneNode(!0);if(e)Object.keys(e).forEach((s)=>{let r=a.querySelector(`[hypur="${s}"]`);if(r===null)throw new Error(`Grain of name ${s} could not be found`);r.innerText=e[s]});n.listeners.forEach((s)=>{a.addEventListener(s.eventType,(r)=>s.action(r,e||{}))}),o.set(a,e||{}),t.base.append(a)}function g(t,n,e){let a=n.base.cloneNode(!0);a.innerHTML=e,n.listeners.forEach((s)=>{a.addEventListener(s.eventType,(r)=>s.action(r,e||{}))}),o.set(a,e||{}),t.base.append(a)}var A={grain:S,hypermedia:g};class f{base;constructor(t){let n=document.querySelector(`form[hypur=${t}]`);if(n===null)throw new Error(`HTMLElement ${t} does not exist`);this.base=n,this.base.addEventListener("submit",async(e)=>{e.preventDefault();let a=this.base.getAttribute("method"),s=this.base.getAttribute("action"),r=new FormData(this.base),d={};r.forEach((E,T)=>{d[T]=E});let c=new URL(window.location.origin,s);await Promise.resolve(this.handleData(d));let h=await this.fetcher(c,a,r);await Promise.resolve(this.handleResponse(h))})}async fetcher(t,n,e){i.start();let a=await fetch(t,{method:n,body:e});return i.end(),a}handleData(t){}handleResponse(t){}}var O=window.HYPUR.LOADING;export{o as stateStore,x as prepend,O as loading,A as append,f as GrainForm,p as Grain};
